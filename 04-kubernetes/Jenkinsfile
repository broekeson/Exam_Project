pipeline {
    agent any

    environment {
        KUBECONFIG = '/var/lib/jenkins/workspace/altschool/01-terraform/kubeconfig.yaml'
    }

    stages {
        stage('deploy-web-app') {
          steps {
              dir('04-kubernetes') {
              sh '''
              kubectl apply -f 01-k8s-web-app/a-namespace.yaml
              kubectl apply -f 01-k8s-web-app/secret.yaml
              kubectl apply -f 01-k8s-web-app/configMap.yaml
              kubectl apply -f 01-k8s-web-app/db-deployment.yaml
              kubectl apply -f 01-k8s-web-app/db-service.yaml
              kubectl apply -f 01-k8s-web-app/web-app-deployment.yaml
              kubectl apply -f 01-k8s-web-app/web-app-service.yaml
              '''
              }
          }
      }
        stage('deploy-sock-shop') {
          steps {
              dir('04-kubernetes') {
              sh '''
              kubectl apply -f 02-k8s-sock-shop/complete-demo.yaml
              kubectl apply -f 02-k8s-sock-shop/manifests-monitoring/
              kubectl apply -f 02-k8s-sock-shop/manifests-alerting/
              '''
              }
          }
       }
    } 
}
